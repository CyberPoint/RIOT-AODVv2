
import argparse
import traceback
import sys
import os

working_dir = "./dumps/"

def pcap_to_xml(pcap_file_str):
    global working_dir

    # make sure we have a directory to operate in
    if (not os.path.exists(working_dir)):
        os.makedirs(working_dir)

    xml_file_str = working_dir + pcap_file_str.split("/")[-1].split(".")[0] + ".xml"
    print xml_file_str, pcap_file_str
    
    # make pcap python-readable by converting it to xml, store in file
    os.system("tshark -r %s -V -T pdml >> %s" %(pcap_file_str, xml_file_str))

def handle_capture():
    pass

def main():
    pcap_file_str = ""
    
    parser = argparse.ArgumentParser(description='evaluate traffic generated by auto_test')
    parser.add_argument('-f','--file', type=str, help='pcap file to evaluate')

    args = parser.parse_args()
    pcap_file_str = args.file

    pcap_to_xml(pcap_file_str)
    handle_capture()

if __name__ == "__main__":
    main()